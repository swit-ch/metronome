<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width user-scalable=no">
    <title>Metronome swit-ch testing</title>
    <link rel="stylesheet" href="css/main.css">
    
    <style type="text/css">
      #github {
        position: absolute; top: -5px; right: 15px;
      }
      input[type="range"] {
         height: 20px; width: 200px;
      }
    </style>
    <!-- <script src="http://cwilso.github.io/AudioContext-MonkeyPatch/AudioContextMonkeyPatch.js"></script> -->
    <!-- <script src="../AudioContext-MonkeyPatch/AudioContextMonkeyPatch.js"></script> -->
    <script src="js/AudioContextMonkeyPatch.js"></script> 
        
    <script src="js/metronome.js"></script>
  </head>
  <body>
    <span>
    <a id="github" href="https://github.com/cwilso/metronome" >Fork me on GitHub</a>
    </span>
    <div id="controls">
  <!--   play doesn't  work on iOS Safari ?!   -->
     <div class="play" id="playCtl">play</div>
      <div id="tempoBox">Tempo: <span id="showTempo"></span>BPM <input id="tempoCtl" type="range"></div>      
      <div>Resolution:<select id="resoCtl"><option>16th notes<option>8th notes<option>Quarter notes</select></div>
      <div>Gain: <span id="showGain"></span><input type="range" id="gainCtl">
      </div>
    </div>
    <script type="text/javascript"> 
      
      // initial tempo and gain defined in metronome.js
      
      // don't use html ele ID as var, see: 
      // https://www.tjvantoll.com/2012/07/19/dom-element-references-as-global-variables/
      'use strict';
      
      var playCtl = document.getElementById('playCtl');
      var tempoCtl = document.getElementById('tempoCtl');
      var showTempo = document.getElementById('showTempo');
      var resoCtl = document.getElementById('resoCtl');
      var gainCtl = document.getElementById('gainCtl');
      var showGain = document.getElementById('showGain');    
      
      var tempoSpec = {
        min: 30, max: 160, step: 1, value: tempo
      };
      var gainSpec = {
        min: 0, max: 1, step: "any", value: gain
      };
      
      // setAttribute any better ?
      tempoCtl.min = tempoSpec.min;
      tempoCtl.max = tempoSpec.max;
      tempoCtl.step = tempoSpec.step;
      tempoCtl.value = tempoSpec.value;
      gainCtl.min = gainSpec.min;
      gainCtl.max = gainSpec.max;
      gainCtl.step = gainSpec.step;
      gainCtl.value = gainSpec.value;
      
      function togglePlay(){
        var str = play();
        playCtl.textContent = str;
      }
      function setTempo(bpm){
        tempo = bpm;
        showTempo.textContent = tempo;
      }
      function updGainGUI(){
        showGain.textContent = Math.round(gain * 100) / 100;
      }
      function setGain(val){
        setMainGain(val);
        updGainGUI();
      }
      
      playCtl.addEventListener('click', togglePlay, false);
      tempoCtl.addEventListener('input', function (event){
        setTempo(event.target.value);
      }, false);
      resoCtl.addEventListener('change', function (event){
        noteResolution = event.target.selectedIndex;
     }, false);
      gainCtl.addEventListener('input', function (event){
        var val = event.target.value;
        setGain(val);
      }, false);
      
      // init
      setTempo(120);
//       setGain(0.5); // too early
      updGainGUI();
    </script>
   </body>
</html>